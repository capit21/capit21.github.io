<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Corazón píxel a píxel</title>
  <style>
    html,body{
      height:100%; margin:0; background:#000; color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center;
    }
    canvas{
      display:block;
      width:100vw;
      height:80vh;
    }
    #texto{
      margin-top:20px;
      font-size:20px;
      width:80%;
      text-align:center;
      white-space:pre-wrap;
      font-family: 'Segoe UI', sans-serif;
      min-height:120px;
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="texto"></div>

  <script>
    const mensaje = "No hay nada que agregar sabes todo, si estar en una situación afectuosa contigo significaba sufrir a mí me da igual, sería como vivir con miedo a morir, una idea o algo malo no le quita los buenos momentos que se viven. Ahora estás dándole a lo tuyo, me da pena ajena decir esto pero bueno, espero que en su debido momento aparezca alguien que quieras y que te quiera mucho. Nunca te dije los halagos por decir o por bobeo, realmente pienso que eres única, graciosa, rara y obviamente hermosa, mereces que todo en la vida.";

    const textoDiv = document.getElementById('texto');
    let index = 0;

    function escribir(){
      if(index < mensaje.length){
        textoDiv.textContent += mensaje.charAt(index);
        index++;
        setTimeout(escribir, 40);
      }
    }

    // --- ANIMACIÓN DEL CORAZÓN ---
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const color = '#ff3366';
    const pixelSize = 6;
    const pixelsPerSecond = 200;

    function fitCanvas(){
      const ratio = window.devicePixelRatio || 1;
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = (window.innerHeight * 0.8) + 'px';
      canvas.width = Math.floor(window.innerWidth * ratio);
      canvas.height = Math.floor(window.innerHeight * 0.8 * ratio);
      ctx.setTransform(ratio,0,0,ratio,0,0);
    }
    window.addEventListener('resize', fitCanvas);
    fitCanvas();

    function isInHeart(x,y){
      const v = Math.pow(x*x + y*y - 1, 3) - x*x * Math.pow(y,3);
      return v <= 0;
    }

    function buildHeartPixels(pxSize){
      const w = canvas.width / (window.devicePixelRatio || 1);
      const h = canvas.height / (window.devicePixelRatio || 1);
      const hw = Math.min(w,h) * 0.9;
      const cols = Math.floor(hw / pxSize);
      const rows = cols;
      const cx = w/2, cy = h/2;
      const pixels = [];
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const sx = (c - cols/2 + 0.5) * pxSize + cx;
          const sy = (r - rows/2 + 0.5) * pxSize + cy;
          const nx = (sx - cx) / (hw/2) * 1.3;
          const ny = - (sy - cy) / (hw/2) * 1.3;
          if(isInHeart(nx,ny)) pixels.push({x:Math.round(sx), y:Math.round(sy)});
        }
      }
      return pixels;
    }

    function clear(){
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }

    let pixelList = buildHeartPixels(pixelSize);
    let revealed = 0;
    let lastTime = null;
    let rafId = null;

    function drawPixel(cx, cy){
      ctx.fillStyle = color;
      ctx.fillRect(cx - pixelSize/2, cy - pixelSize/2, pixelSize, pixelSize);
    }

    function drawOutline(){
      const w = canvas.width / (window.devicePixelRatio || 1);
      const h = canvas.height / (window.devicePixelRatio || 1);
      const cx = w/2;
      const cy = h/2;
      const steps = 600;
      ctx.save();
      ctx.globalAlpha = 0.06;
      ctx.beginPath();
      for(let i=0;i<steps;i++){
        const t = i/steps * Math.PI*2;
        const x = 16*Math.pow(Math.sin(t),3);
        const y = 13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
        const nx = x/18;
        const ny = -y/18;
        const sx = nx * (Math.min(w,h)*0.45) + cx;
        const sy = ny * (Math.min(w,h)*0.45) + cy;
        if(i===0) ctx.moveTo(sx,sy); else ctx.lineTo(sx,sy);
      }
      ctx.closePath();
      ctx.fillStyle = '#fff';
      ctx.fill();
      ctx.restore();
    }

    function loop(ts){
      if(!lastTime) lastTime = ts;
      const dt = (ts - lastTime) / 1000;
      lastTime = ts;
      const toReveal = Math.floor(dt * pixelsPerSecond);
      if(toReveal > 0){
        for(let i=0;i<toReveal && revealed < pixelList.length;i++){
          const p = pixelList[revealed++];
          drawPixel(p.x, p.y);
        }
      }
      if(revealed >= pixelList.length){
        cancelAnimationFrame(rafId);
        setTimeout(()=>escribir(), 500);
        return;
      }
      rafId = requestAnimationFrame(loop);
    }

    clear();
    drawOutline();
    rafId = requestAnimationFrame(loop);
  </script>
</body>
</html>
